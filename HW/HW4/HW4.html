<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zheng Cui">

<title>HW 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="HW4_files/libs/clipboard/clipboard.min.js"></script>
<script src="HW4_files/libs/quarto-html/quarto.js"></script>
<script src="HW4_files/libs/quarto-html/popper.min.js"></script>
<script src="HW4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HW4_files/libs/quarto-html/anchor.min.js"></script>
<link href="HW4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HW4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HW4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HW4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HW4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HW 4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Zheng Cui </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="linear-interval-search" class="level3">
<h3 class="anchored" data-anchor-id="linear-interval-search">1. Linear interval search</h3>
<section id="write-an-r-function-count.features.linearchr-x-y-gff-to-find-the-number-of-overlapping-features-between-chromosome-coordinates-x-and-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-use-for-loop-to-do-the-counting." class="level4">
<h4 class="anchored" data-anchor-id="write-an-r-function-count.features.linearchr-x-y-gff-to-find-the-number-of-overlapping-features-between-chromosome-coordinates-x-and-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-use-for-loop-to-do-the-counting.">(40%) Write an R function count.features.linear(chr, x, y, GFF) to find the number of overlapping features between chromosome coordinates x and y on a given chromosome chr and annotation data frame GFF. You must use for-loop to do the counting.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imoprt GFF Data </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="st">"E:/Language/R/gencode.v44.primary_assembly.annotation.gff3"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>GFF <span class="ot">&lt;-</span> <span class="fu">read.table</span>(file, <span class="at">header =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GFF) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"seqid"</span>, <span class="st">"source"</span>, <span class="st">"type"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"score"</span>, <span class="st">"strand"</span>, <span class="st">"phase"</span>, <span class="st">"attributes"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(GFF) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(GFF)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>count.features.linear <span class="ot">&lt;-</span> <span class="cf">function</span>(chr, x, y, GFF) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize count to 0</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through each row in the GFF data frame</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(GFF)) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the current feature is on the given chromosome</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (GFF<span class="sc">$</span>seqid[i] <span class="sc">==</span> chr) {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Check if the current  qps with the interval [x, y]</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (GFF<span class="sc">$</span>start[i] <span class="sc">&lt;=</span> y <span class="sc">&amp;&amp;</span> GFF<span class="sc">$</span>end[i] <span class="sc">&gt;=</span> x) {</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        count <span class="ot">&lt;-</span> count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(count)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># E.g</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>chromosome <span class="ot">&lt;-</span> <span class="st">"chr1"</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>interval_start <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>interval_end <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">count.features.linear</span>(chromosome, interval_start, interval_end, GFF)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number overlapping features between chromosome coordinates x and y:"</span>, result, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number overlapping features between chromosome coordinates x and y: 27 </code></pre>
</div>
</div>
</section>
</section>
<section id="vectorized-interval-search" class="level3">
<h3 class="anchored" data-anchor-id="vectorized-interval-search">2. Vectorized interval search</h3>
<section id="write-an-r-function-count.features.vectorizedchr-x-y-gff-to-find-the-number-of-features-between-position-x-and-position-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-avoid-using-a-for-loop-and-use-vectorized-operations-instead." class="level4">
<h4 class="anchored" data-anchor-id="write-an-r-function-count.features.vectorizedchr-x-y-gff-to-find-the-number-of-features-between-position-x-and-position-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-avoid-using-a-for-loop-and-use-vectorized-operations-instead.">(30%) Write an R function count.features.vectorized(chr, x, y, GFF) to find the number of features between position x and position y on a given chromosome chr and annotation data frame GFF. You must avoid using a for-loop and use vectorized operations instead.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>count.features.vectorized <span class="ot">&lt;-</span> <span class="cf">function</span>(chr, x, y, GFF) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter given chromosome chr</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  chr_rows <span class="ot">&lt;-</span> GFF[GFF<span class="sc">$</span>seqid <span class="sc">==</span> chr,]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># count the number of features between position x and position y </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  overlaps <span class="ot">&lt;-</span> <span class="fu">sum</span>(chr_rows<span class="sc">$</span>start <span class="sc">&lt;=</span> y <span class="sc">&amp;</span> chr_rows<span class="sc">$</span>end <span class="sc">&gt;=</span> x)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(overlaps)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># E.g</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>chromosome <span class="ot">&lt;-</span> <span class="st">"chr1"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>interval_start <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>interval_end <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">count.features.vectorized</span>(chromosome, interval_start, interval_end, GFF)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number overlapping features between chromosome coordinates x and y:"</span>, result, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number overlapping features between chromosome coordinates x and y: 27 </code></pre>
</div>
</div>
</section>
</section>
<section id="binary-interval-search" class="level3">
<h3 class="anchored" data-anchor-id="binary-interval-search">3. Binary interval search</h3>
<section id="write-an-r-function-count.features.binarychr-x-y-sorted.coordinates-to-find-the-number-of-features-between-position-x-and-position-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-use-the-binary-search-algorithms-we-discussed-in-class.-you-need-to-sort-the-coordinates-of-all-features-on-the-same-chromosome-before-you-call-the-function.-an-option-is-the-r-function-sort." class="level4">
<h4 class="anchored" data-anchor-id="write-an-r-function-count.features.binarychr-x-y-sorted.coordinates-to-find-the-number-of-features-between-position-x-and-position-y-on-a-given-chromosome-chr-and-annotation-data-frame-gff.-you-must-use-the-binary-search-algorithms-we-discussed-in-class.-you-need-to-sort-the-coordinates-of-all-features-on-the-same-chromosome-before-you-call-the-function.-an-option-is-the-r-function-sort.">(20%) Write an R function count.features.binary(chr, x, y, sorted.coordinates) to find the number of features between position x and position y on a given chromosome chr and annotation data frame GFF. You must use the binary search algorithms we discussed in class. You need to sort the coordinates of all features on the same chromosome before you call the function. An option is the R function sort().</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort GFF Data seqid == "chr1"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sorted_coordinates_chr1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">start =</span> <span class="fu">sort</span>(GFF<span class="sc">$</span>start[GFF<span class="sc">$</span>seqid <span class="sc">==</span> <span class="st">"chr1"</span>]),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">end =</span> <span class="fu">sort</span>(GFF<span class="sc">$</span>end[GFF<span class="sc">$</span>seqid <span class="sc">==</span> <span class="st">"chr1"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIND ALL TARGET ENDS AFTER QUERY START </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>find_query_start <span class="ot">&lt;-</span> <span class="cf">function</span>(ends, query_start) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> <span class="fu">length</span>(ends)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (L <span class="sc">&lt;=</span> R) {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> (L <span class="sc">+</span> R) <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ends[M] <span class="sc">&lt;</span> query_start) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>      L <span class="ot">&lt;-</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      R <span class="ot">&lt;-</span> M <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(R <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co"># FIND ALL TARGET STARTS BEFORE QUERY </span><span class="re">END</span><span class="co">  </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>find_query_end <span class="ot">&lt;-</span> <span class="cf">function</span>(starts, query_end) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> <span class="fu">length</span>(starts)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (L <span class="sc">&lt;=</span> R) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">&lt;-</span> (L <span class="sc">+</span> R) <span class="sc">%/%</span> <span class="dv">2</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (starts[M] <span class="sc">&gt;</span> query_end) {</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      R <span class="ot">&lt;-</span> M <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      L <span class="ot">&lt;-</span> M <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(L <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>count.features.binary <span class="ot">&lt;-</span> <span class="cf">function</span>(chr, x, y, sorted_coordinates_chr1) {</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retrieve the sorted start and end coordinates</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  sorted_starts <span class="ot">&lt;-</span> sorted_coordinates_chr1<span class="sc">$</span>start</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  sorted_ends <span class="ot">&lt;-</span> sorted_coordinates_chr1<span class="sc">$</span>end</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  start_idx <span class="ot">&lt;-</span> <span class="fu">find_query_start</span>(sorted_ends, x)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  end_idx <span class="ot">&lt;-</span> <span class="fu">find_query_end</span>(sorted_starts, y)</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count of features is the difference between the indices (+1 since both are inclusive), </span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but we should also handle the case where no overlapping features are found.</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">0</span>, end_idx <span class="sc">-</span> start_idx <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(count)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have sorted_coordinates properly set up:</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>chromosome <span class="ot">&lt;-</span> <span class="st">"chr3"</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>interval_start <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>interval_end <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">count.features.binary</span>(chromosome, interval_start, interval_end, sorted_coordinates_chr1)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Number of overlapping features:"</span>, result, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of overlapping features: 27 </code></pre>
</div>
</div>
</section>
</section>
<section id="reporting-the-runtime" class="level3">
<h3 class="anchored" data-anchor-id="reporting-the-runtime">4. Reporting the runtime</h3>
<section id="test-the-three-functions-on-the-same-input-and-human-genome-annotation-file.-report-the-runtime-as-for-each-method-on-at-least-two-examples-using-the-system.time-function.-do-not-include-time-for-loading-the-genome-annotation-file-or-sorting-the-coordinates." class="level4">
<h4 class="anchored" data-anchor-id="test-the-three-functions-on-the-same-input-and-human-genome-annotation-file.-report-the-runtime-as-for-each-method-on-at-least-two-examples-using-the-system.time-function.-do-not-include-time-for-loading-the-genome-annotation-file-or-sorting-the-coordinates.">(10%) Test the three functions on the same input and human genome annotation file. Report the runtime as for each method on at least two examples using the system.time() function. Do not include time for loading the genome annotation file or sorting the coordinates.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>chromosome1 <span class="ot">&lt;-</span> <span class="st">"chr1"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>interval_start1 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>interval_end1 <span class="ot">&lt;-</span> <span class="dv">20000</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear search</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>linear_time1 <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  result1_linear <span class="ot">&lt;-</span> <span class="fu">count.features.linear</span>(chromosome1, interval_start1, interval_end1, GFF)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Linear search runtime for example 1:"</span>, linear_time1[<span class="st">"elapsed"</span>], <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear search runtime for example 1: 5.53 seconds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorized search</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>vectorized_time1 <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  result1_vectorized <span class="ot">&lt;-</span> <span class="fu">count.features.vectorized</span>(chromosome1, interval_start1, interval_end1, GFF)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Vectorized search runtime for example 1:"</span>, vectorized_time1[<span class="st">"elapsed"</span>], <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Vectorized search runtime for example 1: 0.09 seconds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary search</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>binary_time1 <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  result1_binary <span class="ot">&lt;-</span> <span class="fu">count.features.binary</span>(chromosome1, interval_start1, interval_end1, sorted_coordinates_chr1)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Binary search runtime for example 1:"</span>, binary_time1[<span class="st">"elapsed"</span>], <span class="st">"seconds</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Binary search runtime for example 1: 0 seconds</code></pre>
</div>
</div>
</section>
</section>
<section id="e1-100.-query-interval-spanning-only-known-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="e1-100.-query-interval-spanning-only-known-coordinates">E1 (100%). Query interval spanning only known coordinates</h3>
<section id="if-the-query-interval-x-y-has-a-special-property-such-that-x-and-y-must-take-values-from-coordinates-of-some-intervals-in-the-annotation-can-you-develop-code-to-run-even-faster-than-the-best-general-solutions-you-have-developed-above" class="level4">
<h4 class="anchored" data-anchor-id="if-the-query-interval-x-y-has-a-special-property-such-that-x-and-y-must-take-values-from-coordinates-of-some-intervals-in-the-annotation-can-you-develop-code-to-run-even-faster-than-the-best-general-solutions-you-have-developed-above">If the query interval [x, y] has a special property such that x and y must take values from coordinates of some intervals in the annotation, can you develop code to run even faster than the best general solutions you have developed above?</h4>
</section>
<section id="note" class="level4">
<h4 class="anchored" data-anchor-id="note">Note</h4>
</section>
<section id="x-and-y-do-not-have-to-be-from-the-save-interval-in-the-annotation.-for-example-if-the-annotation-includes-intervals-13815229-then38-is-a-valid-query-intervalas-well-as-815" class="level4">
<h4 class="anchored" data-anchor-id="x-and-y-do-not-have-to-be-from-the-save-interval-in-the-annotation.-for-example-if-the-annotation-includes-intervals-13815229-then38-is-a-valid-query-intervalas-well-as-815">x and y do not have to be from the save interval in the annotation. For example, if the annotation includes intervals {(1,3),(8,15),(2,29)}, then(3,8) is a valid query interval,as well as (8,15)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sort GFF</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sorted_gff <span class="ot">&lt;-</span> GFF[<span class="fu">order</span>(GFF<span class="sc">$</span>start, GFF<span class="sc">$</span>end),]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>sorted_coords <span class="ot">&lt;-</span> <span class="fu">c</span>(sorted_gff<span class="sc">$</span>start, sorted_gff<span class="sc">$</span>end)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>sorted_coords <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(sorted_coords))  <span class="co"># sort and unique</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  fibonacci_search function</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>fibonacci_search <span class="ot">&lt;-</span> <span class="cf">function</span>(arr, x) {</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  fibMm2 <span class="ot">&lt;-</span> <span class="dv">0</span>  <span class="co"># (m-2)nd Fibonacci number</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  fibMm1 <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># (m-1)st Fibonacci number</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  fibM <span class="ot">&lt;-</span> fibMm2 <span class="sc">+</span> fibMm1</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gets the smallest value in the Fibonacci sequence that is larger than the array length</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (fibM <span class="sc">&lt;</span> <span class="fu">length</span>(arr)) {</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    fibMm2 <span class="ot">&lt;-</span> fibMm1</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    fibMm1 <span class="ot">&lt;-</span> fibM</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    fibM <span class="ot">&lt;-</span> fibMm2 <span class="sc">+</span> fibMm1</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  offset <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (fibM <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">min</span>(offset <span class="sc">+</span> fibMm2, <span class="fu">length</span>(arr)<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (arr[i] <span class="sc">&lt;</span> x) {</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      fibM <span class="ot">&lt;-</span> fibMm1</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>      fibMm1 <span class="ot">&lt;-</span> fibMm2</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      fibMm2 <span class="ot">&lt;-</span> fibM <span class="sc">-</span> fibMm1</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>      offset <span class="ot">&lt;-</span> i</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (arr[i] <span class="sc">&gt;</span> x) {</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>      fibM <span class="ot">&lt;-</span> fibMm2</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>      fibMm1 <span class="ot">&lt;-</span> fibMm1 <span class="sc">-</span> fibMm2</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>      fibMm2 <span class="ot">&lt;-</span> fibM <span class="sc">-</span> fibMm1</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(i)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (fibMm1 <span class="sc">&amp;&amp;</span> arr[<span class="fu">length</span>(arr)] <span class="sc">==</span> x) {</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">length</span>(arr))</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a><span class="co"># query in fibonacci</span></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>query_with_fibonacci <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, sorted_coords) {</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use fibonacci to find x and y</span></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  start_index <span class="ot">&lt;-</span> <span class="fu">fibonacci_search</span>(sorted_coords, x)</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>  end_index <span class="ot">&lt;-</span> <span class="fu">fibonacci_search</span>(sorted_coords, y)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (start_index <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">||</span> end_index <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>) {</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Invalid x or y provided!"</span>)</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># located </span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  overlapped_intervals <span class="ot">&lt;-</span> sorted_coords[(start_index<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>end_index]</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(overlapped_intervals)</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">577</span>   </span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">20007</span>  </span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">query_with_fibonacci</span>(x, y, sorted_coords)</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]   647   648  1601  1602  1670  1671  2585  2675  2676  2678  2692  3229
 [13]  3230  3304  3307  4262  4263  4329  4331  4400  4402  4469  4470  4612
 [25]  5511  5512  5579  5587  5655  5657  5729  5761  5826  5891  5904  5906
 [37]  6094  6101  6126  6127  6129  6216  6370  6991  7102  7322  7404  7445
 [49]  7446  7514  7518  7585  7586  7588  7817  7977  7989  8050  8267  8269
 [61]  8295  8364  8366  8368  8527  8529  8570  8572  8604  8655  9205  9207
 [73]  9209  9365  9537  9990  9991 10058 10059 10140 10191 10404 10405 10469
 [85] 10470 10472 10598 10760 10762 10764 10766 10911 11083 11103 11125 11287
 [97] 11288 11451 11555 11595 11613 11615 11616 11707 11745 11753 11758 11768
[109] 11769 11799 11802 11861 11869 11908 12010 12057 12134 12137 12138 12179
[121] 12190 12206 12207 12227 12265 12266 12291 12294 12310 12336 12337 12340
[133] 12358 12378 12402 12572 12574 12575 12613 12659 12663 12697 12704 12721
[145] 12726 12733 12740 12801 12822 12824 12834 12902 12906 12964 12975 13001
[157] 13052 13076 13088 13102 13152 13156 13157 13201 13221 13338 13351 13354
[169] 13370 13374 13453 13487 13501 13566 13670 13783 14061 14090 14138 14146
[181] 14148 14149 14195 14299 14381 14404 14409 14475 14490 14497 14501 14511
[193] 14513 14522 14588 14652 14653 14659 14671 14673 14674 14720 14742 14747
[205] 14749 14771 14806 14807 14809 14831 14851 14940 14944 14958 15005 15038
[217] 15081 15085 15149 15153 15481 15617 15633 15796 15822 15887 15888 15909
[229] 15913 15947 15953 15956 16023 16061 16065 16290 16352 16448 16502 16537
[241] 16544 16549 16561 16607 16718 16722 16738 16765 16856 16858 16871 16876
[253] 16880 16898 16916 16922 16965 16969 17051 17052 17055 17119 17166 17170
[265] 17233 17234 17263 17264 17266 17291 17344 17348 17368 17369 17427 17436
[277] 17479 17483 17501 17514 17604 17606 17719 17723 17742 17750 17855 17859
[289] 17915 17957 18028 18037 18058 18061 18068 18174 18183 18227 18268 18296
[301] 18364 18366 18367 18373 18381 18432 18471 18475 18476 18478 18479 18492
[313] 18897 18969 19018 19172 19619 19833 19895 20007</code></pre>
</div>
</div>
</section>
</section>
<section id="e2-100.-overlapping-intervals-for-every-interval" class="level3">
<h3 class="anchored" data-anchor-id="e2-100.-overlapping-intervals-for-every-interval">E2 (100%). Overlapping intervals for every interval</h3>
<section id="if-you-are-given-a-collection-of-n-intervals-x1-y1-.-.-.-xn-yn-can-you-design-an-algorithm-with-implementation-in-any-language-your-like-to-find-overlapping-intervals-for-each-and-every-interval-in-less-than-quadratic-time-little-oh-on2" class="level4">
<h4 class="anchored" data-anchor-id="if-you-are-given-a-collection-of-n-intervals-x1-y1-.-.-.-xn-yn-can-you-design-an-algorithm-with-implementation-in-any-language-your-like-to-find-overlapping-intervals-for-each-and-every-interval-in-less-than-quadratic-time-little-oh-on2">If you are given a collection of n intervals [x1, y1 ], . . ., [xn, yn] , can you design an algorithm with implementation in any language your like to find overlapping intervals for each and every interval in less than quadratic time little-oh o(n^2)?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to find overlap in a series of time intervals</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>find_overlapping_intervals <span class="ot">&lt;-</span> <span class="cf">function</span>(intervals) {</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an events list</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  events <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For each interval, add a start event and an end event</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># event is a vector containing a point in time, an event type (start or end), and an interval index</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(intervals)) {</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    events <span class="ot">&lt;-</span> <span class="fu">c</span>(events, <span class="fu">list</span>(<span class="fu">c</span>(intervals[[i]][<span class="dv">1</span>], <span class="cn">TRUE</span>, i)), <span class="fu">list</span>(<span class="fu">c</span>(intervals[[i]][<span class="dv">2</span>], <span class="cn">FALSE</span>, i)))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort events by their coordinates, and then by their type (start before end)</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  sorted_events <span class="ot">&lt;-</span> events[<span class="fu">order</span>(<span class="fu">sapply</span>(events, <span class="st">'['</span>, <span class="dv">1</span>), <span class="sc">-</span><span class="fu">sapply</span>(events, <span class="st">'['</span>, <span class="dv">2</span>))]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializes a vector to track the current activity interval</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  active_intervals <span class="ot">&lt;-</span> <span class="fu">integer</span>(<span class="dv">0</span>)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Initializes a list of the same length as the interval list to store overlapping interval indexes</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  overlap <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(intervals))</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># use for to iterate over sorted events</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (event <span class="cf">in</span> sorted_events) {</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> event[<span class="dv">3</span>]</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (event[<span class="dv">2</span>]) { <span class="co"># If it's a start event</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (active_idx <span class="cf">in</span> active_intervals) {</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Adds each other's indexes to the overlapping list of currently active intervals and current intervals</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        overlap[[idx]] <span class="ot">&lt;-</span> <span class="fu">c</span>(overlap[[idx]], active_idx)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>        overlap[[active_idx]] <span class="ot">&lt;-</span> <span class="fu">c</span>(overlap[[active_idx]], idx)</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Adds the current interval to the active interval list</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>      active_intervals <span class="ot">&lt;-</span> <span class="fu">c</span>(active_intervals, idx)</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { <span class="co"># If it's an end event</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      active_intervals <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(active_intervals, idx)<span class="co"># Removes the current interval from the active interval list</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns a list of overlapping intervals</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(overlap)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a list of intervals to test</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>intervals <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>))</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the function and print the result</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>overlaps <span class="ot">&lt;-</span> <span class="fu">find_overlapping_intervals</span>(intervals)</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(overlaps)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 3 2

[[2]]
[1] 1 3

[[3]]
[1] 1 2 4

[[4]]
[1] 3

[[5]]
NULL</code></pre>
</div>
</div>
</section>
<section id="function-definition" class="level4">
<h4 class="anchored" data-anchor-id="function-definition">1. Function definition:</h4>
<p>The find_overlapping_intervals function receives a list of intervals, where each element is a two-digit operator that represents the start and end point of an interval.</p>
</section>
<section id="create-event-list" class="level4">
<h4 class="anchored" data-anchor-id="create-event-list">2. Create event list:</h4>
<p>The function first creates an empty list, events. For each interval in the interval, the function adds two events to events: A start event (marked TRUE) that contains the start time of the interval and the index of the interval. An end event (marked FALSE) that contains the end time of the interval and the index of the interval. This way, each interval is represented by two events in Events.</p>
</section>
<section id="sort-events" class="level4">
<h4 class="anchored" data-anchor-id="sort-events">3. Sort events:</h4>
<p>Use the order function to sort the events, first by point in time (time coordinates) and then by event type (start event before end event). The sorting step is important to check for overlap later.</p>
</section>
<section id="detection-overlap" class="level4">
<h4 class="anchored" data-anchor-id="detection-overlap">4. Detection overlap:</h4>
<p>Initialize active_intervals (an empty integer initialization) to track the time interval for the current activity (that is, it has started but not yet ended). Initializes overlap (a list) to store indexes of other intervals that each interval overlaps.</p>
</section>
<section id="handle-each-event" class="level4">
<h4 class="anchored" data-anchor-id="handle-each-event">5. Handle each event:</h4>
<p>Iterate through the sorted list of events: If a start event is encountered, its index is added to the mid-active_interval and the overlap is updated to reflect the overlap between the current active interval and the newly started interval. If it is an end event, the active_interval removes the corresponding interval index because the interval has ended.</p>
</section>
<section id="return-result" class="level4">
<h4 class="anchored" data-anchor-id="return-result">6. Return result:</h4>
<p>The function finally overlaps a list where each element is an integer operator, containing the indexes of other intervals that overlap the corresponding interval returns.</p>
</section>
<section id="test-function" class="level4">
<h4 class="anchored" data-anchor-id="test-function">7. Test function:</h4>
<p>In the last part of the code, I use list(c(1, 5), c(2, 6), c(1, 8), c(7, 9), c(10, 15)), call the function to test, and then print the result for overlaps.</p>
</section>
</section>
<section id="e3-25.-biological-application" class="level3">
<h3 class="anchored" data-anchor-id="e3-25.-biological-application">E3 (25%). Biological application</h3>
<section id="demonstrate-on-a-biology-dataset-where-you-can-apply-any-program-you-developed-above.-you-must-provide-biological-motivation-and-result-interpretation-for-this-part-of-work" class="level4">
<h4 class="anchored" data-anchor-id="demonstrate-on-a-biology-dataset-where-you-can-apply-any-program-you-developed-above.-you-must-provide-biological-motivation-and-result-interpretation-for-this-part-of-work">Demonstrate on a biology dataset where you can apply any program you developed above. You must provide biological motivation and result interpretation for this part of work</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert sorted_coordinates_chr1 to intervals format</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> intervals_chr1 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sorted_coordinates_chr1<span class="sc">$</span>start), <span class="cf">function</span>(i) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(sorted_coordinates_chr1<span class="sc">$</span>start[i], sorted_coordinates_chr1<span class="sc">$</span>end[i])</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the find_overlapping_intervals function</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>overlaps_chr1 <span class="ot">&lt;-</span> <span class="fu">find_overlapping_intervals</span>(intervals_chr1)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(overlaps_chr1, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2 3 4 5 6

[[2]]
[1] 1 3 4 5 6 7

[[3]]
[1] 1 2 4 5 6 7

[[4]]
[1] 1 2 3 5 6 7 8 9

[[5]]
[1] 1 2 3 4 6 7 8 9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(overlaps_chr1, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 2 3 4 5 6

[[2]]
[1] 1 3 4 5 6 7

[[3]]
[1] 1 2 4 5 6 7

[[4]]
[1] 1 2 3 5 6 7 8 9

[[5]]
[1] 1 2 3 4 6 7 8 9</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>